{"version":3,"sources":["../src/script.js"],"names":["msgerForm","get","msgerInput","msgerChat","BOT_MSGS","BOT_IMG","PERSON_IMG","BOT_NAME","PERSON_NAME","DEFAULT_MESSAGE","global_state","window","localStorage","getItem","undefined","addEventListener","event","preventDefault","msgText","value","appendMessage","submitMessage","name","img","side","text","id","msgHTML","formatDate","Date","insertAdjacentHTML","scrollTop","botResponse","r","random","length","delay","split","setTimeout","state","context","getContext","makeAjaxCall","client_processor","callback","console","log","wave","fetch","method","body","JSON","stringify","then","response","json","data","setItem","document","getElementById","remove","message","Math","date","now","secondsSinceEpoch","round","getTime","getHours","getMinutes","getDay","getMonth","getDate","getYear","selector","root","querySelector","h","m","slice","min","max","floor"],"mappings":"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","sourcesContent":["const msgerForm = get(\".msger-inputarea\");\nconst msgerInput = get(\".msger-input\");\nconst msgerChat = get(\".msger-chat\");\n\nconst BOT_MSGS = [\n  \"Hi, how are you today?\",\n  \"Ohh... I can't understand what you trying to say. Sorry!\",\n  \"I like to play games... But I don't know how to play!\",\n  \"Sorry if my answers are not relevant. :))\",\n  \"I feel sleepy! :(\"\n];\n\n// Icons made by Freepik from www.flaticon.com\nconst BOT_IMG = \"https://cdn-icons-png.flaticon.com/512/6618/6618664.png\";\nconst PERSON_IMG = \"https://cdn-icons-png.flaticon.com/512/30/30473.png\";\nconst BOT_NAME = \"Kat\";\nconst PERSON_NAME = \"Human\";\nconst DEFAULT_MESSAGE = \"Hello Kat\"\n\nvar global_state = {\"state\":{\"message\":DEFAULT_MESSAGE}}\nif (window.localStorage.getItem('user_id') != undefined) {\n  global_state['state']['user_id'] = window.localStorage.getItem('user_id')\n}\n\n\nmsgerForm.addEventListener(\"submit\", event => {\n  event.preventDefault();\n\n  const msgText = msgerInput.value;\n  if (!msgText) return;\n\n  appendMessage(PERSON_NAME, PERSON_IMG, \"right\", msgText);\n  msgerInput.value = \"\";\n  global_state[\"message\"] = msgText\n  submitMessage(global_state);\n});\n\nfunction appendMessage(name, img, side, text, id) {\n  //   Simple solution for small apps\n  const msgHTML = `\n    <div class=\"msg ${side}-msg\" id=\"${id}\">\n      <div class=\"msg-img\" style=\"background-image: url(${img})\"></div>\n\n      <div class=\"msg-bubble\">\n        <div class=\"msg-info\">\n          <div class=\"msg-info-name\">${name}</div>\n          <div class=\"msg-info-time\">${formatDate(new Date())}</div>\n        </div>\n\n        <div class=\"msg-text\">${text}</div>\n      </div>\n    </div>\n  `;\n\n  msgerChat.insertAdjacentHTML(\"beforeend\", msgHTML);\n  msgerChat.scrollTop += 500;\n}\n\nfunction botResponse() {\n  const r = random(0, BOT_MSGS.length - 1);\n  const msgText = BOT_MSGS[r];\n  const delay = msgText.split(\" \").length * 100;\n\n  setTimeout(() => {\n    appendMessage(BOT_NAME, BOT_IMG, \"left\", msgText);\n  }, delay);\n}\n\nfunction submitMessage(state) {\n  context = getContext()\n  state['context'] = context\n  makeAjaxCall(state)\n}\n\n// TODO make function more robust\nfunction client_processor(callback) {\n    switch (callback) {\n        case \"callback()\":\n            global_state[\"message\"] = DEFAULT_MESSAGE\n            submitMessage(global_state)\n            break;\n        default:\n            console.log(\"received unexpected call back:\" + callback)\n    }\n}\n\nfunction makeAjaxCall(state) {\n  //fetch('http://127.0.0.1:5000/messages/' + JSON.stringify(state))\n  wave = '<div id=\"typing-loader\"></div>'\n  appendMessage(BOT_NAME, BOT_IMG, \"left\", wave, 'typing')\n  fetch('http://127.0.0.1:5000/messages', {\n    method:'post',\n    body: JSON.stringify(state)\n  })\n  .then(response => response.json())\n  .then((data) => {\n    global_state = data\n    console.log(data)\n    if (data['state']['user_id'] != undefined)\n      {\n        if (data['state']['user_id'] != -1) {\n        window.localStorage.setItem('user_id',data['state']['user_id'])\n      }\n      }\n    document.getElementById(\"typing\").remove()\n    appendMessage(BOT_NAME, BOT_IMG, \"left\", data.message, \"id-\" + Math.random())\n    // TOOD Move to seperate function\n    if (data['state']['client_processor'] != undefined) {\n        client_processor(data['state']['client_processor'])\n    }\n  })\n }\n\nfunction getContext() {\n  date = new Date()\n  const now = new Date()\n  const secondsSinceEpoch = Math.round(now.getTime() / 1000)\n  context =\n  {\n    'hour': date.getHours(),\n    'minute': date.getMinutes(),\n    'dow': date.getDay(),\n    'month': date.getMonth(),\n    'date': date.getDate(),\n    'year': date.getYear(),\n    'unix_time': secondsSinceEpoch\n\n  }\n  return context\n}\n\n// Utils\nfunction get(selector, root = document) {\n  return root.querySelector(selector);\n}\n\nfunction formatDate(date) {\n  const h = \"0\" + date.getHours();\n  const m = \"0\" + date.getMinutes();\n\n  return `${h.slice(-2)}:${m.slice(-2)}`;\n}\n\nfunction random(min, max) {\n  return Math.floor(Math.random() * (max - min) + min);\n}\n\n// Send init message on load\nsubmitMessage(global_state)\n"],"file":"script.js"}